20180530-AWS_Summit_Tokyo_2018.md
-----

### 概要

* 2018年5月30日（水）〜 6月1日（金）
* 会場：　グランドプリンスホテル新高輪（国際館パミール、飛天）
* 主催：　アマゾン ウェブ サービス ジャパン株式会社
* https://www.awssummit.tokyo/tokyo/
* TW : #AWSSummit

-----

### Amazon Connect で始めるクラウド型コンタクトセンター

* 5月30日(水) 14:00-14:40 飛天 1-H1-2-14

#### 木村 雅史 アマゾン ウェブ サービス ジャパン株式会社 技術統括本部 ソリューションアーキテクト

* Amazonコンタクトセンターは7万人
* これまでライセンスはセールス時の最大値を見越して買うしかない
* 平常時との差が大きく費用が重荷になっていた → なので自分で作った
* コールセンター設置に3ヶ月かかるのが数時間で構築可能に
* 例えば発信元電話番号をCRM参照し顧客状態を把握した上で会話可能に
* 通話録音をS3にメトリクスをDWHへ保存できる
* Salesforceのプラグインとして利用可能、過去のサービス履歴を確認した上ワンクリックで発信可能(間違い電話が無い)
* 顧客接続時間に応じた従量課金、電話回線費用込み、オートスケール
* (日本における料金一例)0080番号は$0.48/日、着信通話料は$0.2294/分、発信通話料は$0.1383/分
* デモ「エーダブリューエスホテル予約センター」を4分で制作

#### 谷澤 雄一郎 株式会社AOKI suitsbox事業部 システム開発・UX担当

* 新規事業で(特に事前)予算が無かったのでAmazon Connectはぴったりだった
* 通話自動応答フロー制作は2日
* SalesforceにAria Solutions Toolkitを追加し、着信時自動ポップアップ・注文後のメモが可能に
* Magento + Stripe + Salesforce + Amazon Connectでリーンスタートアップ、人間はサービス部分だけに注力
* 実は4月の段階では発信番号が非通知だったけど要望出したらすぐに改善された
* 新事業で手に入れたAmazon ConnectのノウハウをAOKI本体に展開、単独のビジネス以上の利益が

#### 事例：株式会社イープラス

* (お年寄り向けの)チケットの抽選販売の当落の電話をオペレータ応答にしているが非常に費用がかかる
* Amazon Connectで自動応答にしたら、オペレータ0人にして24時間応答可能に

#### デモ

* Amazone Dashボタンを押すと電話発信
* データセンターの死活監視にも使える

-----

### 【任天堂様ご登壇事例】Nintendo Switch （TM） 向けプッシュ通知システム「NPNS」

* 5月30日(水) 16:00-16:40 香雲 1-P3-1-16
* 記事化NGセッションなのでタイトルのみ

-----

### 【AWS Tech 再演】AWS のネットワーク設計入門

* 5月30日(水) 19:00-19:40 飛天 1-H1-2-19
* 益子 直樹 アマゾン ウェブ サービス ジャパン株式会社 技術統括本部 ソリューションアーキテクト

#### VPC内から外サービスへのアクセスGW

* Inernet Gateway → 単純にインターネットへ繋ぐ、双方向に広範囲に接続したい場合は良いがセキュリティ的にはやや弱い
* NAT GatewayはAZ毎に設置推奨 → 内側から外側だけ広範囲なアクセスができる
* VPC Endpoint Gateway Type → S3やDBに接続できる
* VPC Endpoint Interface Type → 新しいサービスで接続先がどんどん増えている
* Time Sync →  ただのNTPだけど、NTPのためだけに設定したGateway除去できる

#### マルチAZ

* RDSにマルチAZを指定するとMasterの死活監視をしてSlaveが自動的に昇格する

#### VPCのアドレス

* 一つ目のVPCは変更・削除不可能なので慎重にアドレスを決める
* 基本的には/16(VPCの最大値)で取れば良い
* プライベートアドレスの空きが無い場合、RFC6598 100.64.0.0/10を使うと良い
* VPC Peering(2Hopは不可能で)2つのVPCを接続する
* Direct Connect Gateway、VPCアドレスが別々のものを接続する

-----

### おまけ：オフィス向け無人コンビニ600

* 飛天 地下1階 特設ブース
* https://www.nikkei.com/article/DGXMZO30971150V20C18A5000000/
* RFIDが容器からはみ出して貼られているのはタグの電波はアルミ包装や水を通さないので
* 現状、商品の価格はコンビニに合わせてあるけど、1施設1台設置だと配送コストを考えたら物が売れる毎に若干運営会社の赤字
* 設置費用一月一台5万円から上記赤字分を引いたのが運営会社の利益(なので複数纏めて設置してもらえると配送コストが減って嬉しい)
* 直近のターゲットは福利厚生等で費用会社持ちでもコンビニを置きたいが人件費が捻出出来ない(もしくは単純に雇う人が居ない)所
* 支払いがクレジットカードのみなのが難点、交通系ICカードにも対応したいが料金の徴収方法が難しい(二度タッチ？カード入れてロックする？)

-----

### クラウドへのデータウェアハウスマイグレーション手法

* 5月31日(木) 13:00-13:40 飛天 2-H1-3-13
* 下佐粉 昭 アマゾン ウェブ サービス ジャパン株式会社 技術統括本部 ソリューションアーキテクト

#### 本編
* (入場が遅れたので7分目から)
* 最近は汎用RDBMSの性能が上がっており、専用のデータウェアハウスソフトを使わなくても処理できる場合がある
* データウェアハウスは一括書き込み・SQLの並列読み込み等が優れている
* 事前検証：卓上計算・機能確認に期間を費やしすぎない、仮説を立てたらレッドシフトで試すと良い(費用は1時間単位)
* 機能確認のポイント(スライドで使った表)は後にPDFでアップする
* セキュリティはビルドインのものを使った方が安く早くできるかと
* アプリケーション見直しの検討をする：既存で(ハードを使い切るため)多数データウェアハウス叩くアプリがあっても、移植先はRedshiftだけでなくAurora等より適した物があるか検討する
* (例)大半のユーザが一部のデータしか使わないなら、それだけAuroraに切り出してRedshiftは特権ユーザだけにしてコストを下げる
* 一度に全アプリを移植するのではなく、修正が小さい物から順に移植すると良い

#### 性能検証

* リザルトキャッシュを必ず無効化にする
* ディスクI/O・ネットワーク・実行待ちに対応する
* ディスクI/O：均一に分散する・並列数を増やす、ソートキー設定は重要、またログでソートキーが有効だったか確認できる
* ネットワーク：DS_DIST*→この???が出たら遅いよ、分散方式EVEN・DISTKEY・ALL、性能をよく使うSQLに合わせるか重要度に費用が間に合うなら表をコピーすると良い
* 実行の制御：キューは5個(メモリを均等に分割するため)、一時的に利用スロットを上げるコマンドもある(バッチ等に)
* ショートクエリーアクセラレーション(短いと思ったコマンドを専用キューで実施し待たせない)、逆に長い処理をバッチ用キューに移動して短い処理向けにキューを空ける
* 時間によってメモリ配分を変える(例：夜間は閲覧用のメモリ割り当てを削減しバッチ処理用に宛てる)

#### 移行

* 移行の量を計画する、資産の重要度を検証し全部移行しようとしない

-----

### Amazon Redshift の設計・運用大原則

* 5月31日(木) 14:00-14:40 飛天 2-H1-3-14
* 仲谷 岳志 アマゾン ウェブ サービス ジャパン株式会社 プロフェッショナルサービス シニア・インフラストラクチャー・アーキテクト

#### 本編

* RedshiftはDWHである以上得意不得意なworkロードがある、良さを引き出す設計が必要
* 1・サイジングをちゃんとする：キャパシティ変更には時間がかかるので変更回数を減らす(EC2と比べると)、データ容量は7割で拡張を目安にする(3割は一時テーブルとして使う(初期は8割利用でアラートだが下げる)、1年後に7割以下になりそうなキャパシティを選択)、可能な場合は大きめのノードサイズを選択する(リーダーノードはコンピュートノードに比例する)
* 2・Spectrumのアーキ原則を抑える：データ量に応じたノードスライス数を用意する、古いデータはS3に追い出して繋ぐとコスト節約になる、システムクエリや失敗したクエリには課金されない
* 3・COPYの基本ルール：可能な場合は常にS3からロードする(EC2は遅くて不安定)、一時制約違反の行がロードされるのは仕様(性能重視でロード時は止めない、必要なら一時テーブル使う)、夜間バッチでは許容ロードエラー数を上げる(エラーした物のみ後で処理する)
* 4・ロード経路をセキュアにする：Redshiftと同じプライベートVPCにプロキシーEC2を立ててそこからS3にコピーすると良い、AWSコンフィグ等で監視する
* 5・同時実行要件に正しく対処する：スロット細分が以外の方法を考える(メモリはスロットで等分に割るのでスロット数を減らし十分なメモリを容易した方が処理速度上がる場合がある)、定型クエリはデータマート(キャッシュレイヤ)で対応、探索クエリはRedshift Spectrum
* 6・クエリー特性を考慮する：対話クエリーはキューを分け(特に日中は)優先する、クエリーモニタリングルールで予防線を張る、BIツールに備える(結果セットキャッシュが有効(性能即提示はOFFにしよう))
* 7・VACUUMを工夫する：VACUUM FULL(DELETE_ONLYだとデータ容量が減らない場合がある)を短くてもWeeklyにとどめて実行する、頻繁削除がある場合VACUUMの代わりにディープコピーを使おう
* 8・：UPSERTは一時テーブルを使って行う

-----

### AWS を支えるネットワークインフラと要素技術

* 5月31日(木) 18:00-18:40
* 岡本 京 アマゾン ウェブ サービス ジャパン株式会社 技術統括本部 ソリューションアーキテクト
*

-----

### アンケート用メモ

* 飛天でのレシーバーを使ったセッションは選択したチャンネル番号が正しいか確かめるため、BGMとしてチャンネル番号(と出来れば次回のセッション名)をアナウンスして欲しい(そもそも開始前のレシーバーチェックのため、会場スピーカー＋3チャンネルでBGMを分けて欲しい)

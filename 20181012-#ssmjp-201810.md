20181012-#ssmjp-201810.md
-----

### 概要

* #ssmjp 2018/10
* 日時:2018/10/12(金) 19時00分開場 19時30分頃開始
* 場所:DMM.com

-----

### @akira6592さん	Ansible ではじめるサーバー・ネットワークの自動化 (Ansible2.7情報つき)

* シンプルで始めやすいツール
* モジュールで色々なサーバ・機器に対応
* Web情報はやはり公式が一番良い
  * モジュールインデックスが一番眺めている
* Slack ansiblejp
* もくもく会10月18日恵比寿、成果発表枠3枠中申込0です

-----

### すがいさん	Ansibleで始めるNW設定の自動化について 〜Cisco(VIRL)編〜 (仮)

* Ciscoの機器を例にAnsible
  * 副題：vIRLすごいよ

#### vIRL
* Ciscoのネットワークシミュレーションソフト、個人利用で年間200ドル
* VM上に乗せる、VMに割り当てるメモリは最低8Gだけどこれでは足りない
* Cisco製だけどF5 BIG-IPとかForitgateとかUbuntuとかWin7とかシミュレーションできる
  * これだけで十分Webサービスできる。 注：規約により禁止されています
* OpenStack製、最大5ノードまで拡張できる

#### デモの前説明

* まずvIRLのネットワーク構成図の説明です
  * VM Maestro(JAVAソフト)でvIRLをグラフィカルに表示できる
* 事前に書くスイッチに管理用IPアドレスの設定とデフォルトルートとSSH接続の設定を行う
  * AnsibleはSSH接続ができないと動作しない

#### デモ

* なんか色々出ます、なんか色々出ます、なんか色々出ます
* VM Maestroから機器を選んでコンフィグを確認

##### NX-OSにVLANを作ってeth 3/1にタグVLANで設定

* 順番を間違えると地味に機能しない
  * ethをL2に設定
  * ethをトランクポートに設定
  * VLANを作成＋インターフェースに割り当てる

##### L2 CatalystのポートをタグVLANに設定

* ios_vlanモジュールで設定
  * …、「switchport trunk encap dot1q」が入っておらずにコマンドが空ぶる
  * モジュールだけ行うのは諦めて汎用のIOSコマンド実行モジュールと組み合わせよう
* Ansible的には「show run all」で設定を取得して差分取ると良い

#### 応用編

* [with_nested]を使うと繰り返し行う設定を簡易に書ける
  * 変化する項目一覧と実行するプレイブックに分離できる
  * 「これ(コアスイッチVLAN設定)もデモ、…1個…遅いな(3ポートのVLAN設定に1分かかる)」
  * 巻きでと言われているので、エッジスイッチの設定流しながら別の機器の設定も行います、…こちらは早い

#### まとめ

* 今回紹介したプレイブックには致命的な欠陥があります、頑張って探してください
* NW自動化に向けた課題
  * 手順が複雑になり定型化出来ない

-----

### @togakushiさん	残念な現場にAnsibleを適応してみた過去と現在と未来

* とがくしさん
* OpenSSH入門」書いたけど電子版しか売れないので紙買ってね
  * 紙が売れないと改版されないの…

#### 色々あれなプロジェクトの説明

* 身バレ防止のために削除

#### 導入編

* ぼく：Ansible入れたい
* ぷろまね：Ansibleどこ製？
* ぼく：Red hat、この名前は超強い

#### 検証

* バージョン管理のためMercurialを導入
  * 毎回デグレさせる人が居た…
* 実行時extra_argsで環境毎に切り替えられる

#### 環境の構築

* kickstartでESXiと運用環境を入れてAnsibleで設定
* 評価環境でリハーサルは4時間で終わった(作業用ノートPCが早かったら1時間程度で終わりそう)

#### playbookに落とし込む作業

* 元がエクセル方眼紙設計書
* 設計書の章単位で作った

#### タグ付け

* あまりにplaybookが巨大なのでskipで実行するところまで飛ぶ

#### Sphinxで管理

* 手順やノウハウをドキュメント化
* ルールのドキュメント化

#### まとめ

* 自動化により作業漏れ発生0
* 納品直前にAnsibleを削除
* 人を動かしたいSIerと自動化したい自分の間で軋轢が
  * ただしすごく作業が多いのでお金が出る
* 結局見捨てた

20191120-ansiblejp-Network.md
-----

### 概要

* Ansiblejpネットワーク部 2019.11
* 2019/11/20(水) 19:00
* レッドハット恵比寿オフィス 3階
* https://ansible-users.connpass.com/event/151107/
* TW : [#ansiblejp](https://twitter.com/search?q=%23ansiblejp)

-----

### オープニング by 中村

* 会場スポンサーは RedHat、懇談会スポンサーはf5 BIG-IP
* Ansibleもくもく会は月1回開催、メンターは12名
* Ansible Nightは3ヶ月に1回、また分会も随時(現状予定なし)
* LT, ブログ等コントリビュートしてくださる方歓迎です

----

### 「Ansible2.9 ネットワーク対応のアップデート 」by @akira6592 さん

* Ansible2.9でネットワークリソースモジュールが実装
* L1,L2,L3の設定が多い
* stateが4種類あるのでそれぞれ紹介
* state : merged 書かれた範囲でマージ、書き漏らした項目・インターフェースがあったら放置
* state : replaced 書き漏らしたインターフェースがあったら放置
* state : overriddden インターフェース全体の設定を上書き、書き漏らしたインターフェースがあったらデフォルトに戻す
* state : deleted 指定したインターフェースをデフォルト値に変更
* チェックモードと戻り値のコマンドを見て、動作を確認してから実行を推奨
* Ansible2.9での変更点、ネットワーク機器に不必要なモジュールだった場合は接続しない(2.8は全て接続したので最初のモジュールでエラーが出た)
* fact収集方法が統一化された、がそのまま使うと遅いときがある(そのような場合は収集する物を絞る)
* 2.8interface 、2.9interfaces、と末尾にsが増えているので注意(旧来のは非推奨に)
* fortios_*モジュールが204個追加
* cp_*モジュールがほぼ100に(CheckPoint社のファイアウォール)
* IOS XRは専用ページが追加、接続方法はこちらを見よう

-----

### 「Ansibleで1000台近くネットワーク機器のログを取ってみた話（仮）」by Lisaさん

* ある機械の電源OFFONしたら設定がロールバック→Ansibleで自動化してみよう
* 自動化の障壁 : エクセル(セル結合多数)から巡回リストを作る、telnetや踏み台への対応、実行結果の分析
* ExcelはマクロでCSV化、そこからはPythonで加工
* expectモジュールを使おうとしたけど、踏み台のプロンプトが不定なので難しい
* block, set fact, telnetモジュールを使用
* Jupyter Notebokkで結果を管理
* その後 : 疎通NGだった機器はログイン設定を変更して再チャレンジ、接続できて設定保存がされていない機器は保存コマンドを実行

-----

### 「NW自動化を開発エンジニアが実装したら」by @tomomo1015 さん

* Core 2.4.2, Tower 3.2.3と古いので注意
* データベースエンジニアで赤ずきん(アイコン)の人
* IT人材が足りない、そもそもエンジニアの業種が増えてない？()
* NWは台数が多くて、小さな設定変更も多く自動化の効果が高そう
* また、エラーも上のレイヤーに比べたら定型的
* 開発2名＋NWエンジニア＋RedHatコンサルでNW自動化を2ヶ月でやってみた
* 社内での効能
    * Ansible初の開発2名が、各種設定(いままでならシェルでやっていた)をplaybookで返すようになった
    * だいたい5部署から自動化の依頼が来た
* 自動化の範囲を明確化する、追加の用件は終わってから出そう！
* サーバ/開発エンジニアがAnsibleでNW触れるようになる→NWエンジニアがAnsibleでサーバ触れるようになる！

-----

### LT

#### 「(仮)BIG-IPの作業をTowerでサービス化してみた(空想) 」by ksaegusaさん

* ネットワークエンジニアの作業をボタンとしてアプリエンジニアで提供
* BIG-IPなのはAnsible2.9でコマンドが増えたから！
* ロードバランサーから特定のノードの切り離し/追加を自動化した
* 15行ほどのPlayBook書いただけ

----

#### 「ansibleでFortigateを操作してみた話（仮）」by tatematsu_sanさん

* Ansible2.9で増えたfortios_* のモジュールの説明
* 一般的には公開していないREST APIで実装されている模様
* FortIOS5.4では動かないので注意、この検証は6.0でやった(5.6は未確認)
* CLIと異なりエラーチェックが甘い
* 適当に書くと再起動時にエラーで消されるコンフィグができあがることがあるので注意
    * 動作確認は再起動後に行う

----

#### 「キャリアの商用環境で設定変更作業を自動化した話(仮)」by platinaさん

* キャリアグレードの機器は情報がすくない
* 短い準備期間ですみ、今後の作業が楽できる
* 手順書をそのままプレイブックにするのではなく、本当に必要な項目の見極めが重要

-----

#### Ansibleの限界を超えてファイアウォールのプロビをした話(仮)」by 98hiraさん

* 日本各地に設置した物理サーバをクラウドとして各社に提供するサービス
* 上記のFWに対するAnsibleを書いた
* 作業指示ファイル作成に特化しているため、ループや分岐をしようとすると一気にハードモードになる

-----

#### 「ベンダー開発のモジュールの使い方」 by yascaimさん

* A10Networkとは？
    * ロードバランサーやセキュリティプラットフォームなど
* A10のAnsibleモジュールの数は…4個？
    * ベンダー公式Githubに1400個のモジュールがある！
* さて9月からモジュールがたくさん増えているからgit clone… 今までのプレイブックが全然動かない！
    * 必須の項目増えすぎ、書き方が変わっているパラメータ多過ぎ
* GitHubの変更内容の件はベンダーサポートで聞いた
* 極力変数はPlaybookの外で管理する


-----
